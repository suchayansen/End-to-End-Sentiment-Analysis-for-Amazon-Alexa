<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sentiment Predictor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap');
        
        body {
            font-family: 'Space Grotesk', sans-serif;
            background: linear-gradient(135deg, #1e3a8a 0%, #7c3aed 100%);
            min-height: 100vh;
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }
        
        .glow {
            box-shadow: 0 0 20px rgba(124, 58, 237, 0.5);
        }
        
        .result-positive {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        
        .result-negative {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }
        
        .result-neutral {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }
    </style>
</head>
<body class="p-8">
    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <div class="text-center mb-12">
            <div class="inline-flex items-center justify-center w-20 h-20 bg-white rounded-2xl shadow-2xl mb-6">
                <i class="fas fa-brain text-purple-600 text-4xl"></i>
            </div>
            <h1 class="text-5xl md:text-6xl font-bold text-white mb-4">
                Sentiment Analysis
            </h1>
            <p class="text-xl text-purple-200 max-w-2xl mx-auto">
                Analyze text sentiment instantly with advanced AI technology
            </p>
        </div>

        <div class="grid lg:grid-cols-2 gap-8">
            <!-- Input Card -->
            <div class="bg-white rounded-3xl shadow-2xl p-8 card-hover">
                <h2 class="text-3xl font-bold text-gray-800 mb-6 flex items-center">
                    <div class="w-10 h-10 bg-gradient-to-br from-purple-500 to-blue-500 rounded-lg flex items-center justify-center mr-3">
                        <i class="fas fa-pen text-white"></i>
                    </div>
                    Input Data
                </h2>

                <form id="predictionForm" class="space-y-6">
                    <!-- CSV Upload -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-3">
                            <i class="fas fa-file-csv text-purple-600 mr-2"></i>
                            Upload CSV File
                        </label>
                        <div class="relative group">
                            <input type="file" id="csvFileInput" accept=".csv" class="hidden" onchange="handleFileSelect(this)">
                            <label for="csvFileInput" class="flex flex-col items-center justify-center w-full h-40 bg-gradient-to-br from-purple-50 to-blue-50 border-3 border-dashed border-purple-300 rounded-2xl cursor-pointer hover:border-purple-500 hover:bg-purple-100 transition duration-300">
                                <i class="fas fa-cloud-upload-alt text-purple-500 text-5xl mb-3 group-hover:scale-110 transition duration-300"></i>
                                <p class="text-gray-700 font-semibold" id="fileNameDisplay">Choose file or drag here</p>
                                <p class="text-gray-500 text-sm mt-1">CSV files only</p>
                            </label>
                        </div>
                    </div>

                    <!-- Divider -->
                    <div class="flex items-center my-6">
                        <div class="flex-1 border-t-2 border-gray-200"></div>
                        <span class="px-4 text-gray-500 font-bold text-sm">OR</span>
                        <div class="flex-1 border-t-2 border-gray-200"></div>
                    </div>

                    <!-- Text Input -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-3">
                            <i class="fas fa-keyboard text-purple-600 mr-2"></i>
                            Enter Text
                        </label>
                        <textarea 
                            id="textInput" 
                            rows="6" 
                            placeholder="Type your text here for sentiment analysis..."
                            class="w-full px-4 py-3 bg-gray-50 border-2 border-gray-200 rounded-xl focus:border-purple-500 focus:ring-4 focus:ring-purple-200 focus:outline-none transition duration-300 resize-none"
                        ></textarea>
                    </div>

                    <!-- Predict Button -->
                    <button 
                        type="button" 
                        onclick="predict()" 
                        class="w-full bg-gradient-to-r from-purple-600 to-blue-600 text-white px-8 py-4 rounded-xl font-bold text-lg hover:from-purple-700 hover:to-blue-700 transition duration-300 shadow-lg hover:shadow-2xl transform hover:scale-105 active:scale-95"
                    >
                        <i class="fas fa-magic mr-2"></i>
                        Analyze Sentiment
                    </button>
                </form>
            </div>

            <!-- Results Card -->
            <div class="space-y-6">
                <!-- Prediction Result -->
                <div class="bg-white rounded-3xl shadow-2xl p-8 card-hover">
                    <h2 class="text-3xl font-bold text-gray-800 mb-6 flex items-center">
                        <div class="w-10 h-10 bg-gradient-to-br from-green-500 to-teal-500 rounded-lg flex items-center justify-center mr-3">
                            <i class="fas fa-chart-bar text-white"></i>
                        </div>
                        Prediction
                    </h2>
                    <div id="predictionResult" class="min-h-[200px] flex items-center justify-center">
                        <div class="text-center text-gray-400">
                            <i class="fas fa-arrow-left text-5xl mb-4 opacity-50"></i>
                            <p class="font-semibold">Waiting for input...</p>
                            <p class="text-sm mt-2">Upload a file or enter text to begin</p>
                        </div>
                    </div>
                </div>

                <!-- Graph Container -->
                <div class="bg-white rounded-3xl shadow-2xl p-8 card-hover">
                    <h2 class="text-3xl font-bold text-gray-800 mb-6 flex items-center">
                        <div class="w-10 h-10 bg-gradient-to-br from-pink-500 to-orange-500 rounded-lg flex items-center justify-center mr-3">
                            <i class="fas fa-chart-pie text-white"></i>
                        </div>
                        Visualization
                    </h2>
                    <div id="graphContainer" class="min-h-[250px] flex items-center justify-center">
                        <div class="text-center text-gray-400">
                            <i class="fas fa-chart-line text-5xl mb-4 opacity-50"></i>
                            <p class="font-semibold">No data to display</p>
                            <p class="text-sm mt-2">Charts will appear here after analysis</p>
                        </div>
                    </div>
                </div>

                <!-- Download Button -->
                <button 
                    id="downloadBtn" 
                    style="display:none" 
                    onclick="downloadPredictions()"
                    class="w-full bg-gradient-to-r from-green-600 to-teal-600 text-white px-8 py-4 rounded-xl font-bold text-lg hover:from-green-700 hover:to-teal-700 transition duration-300 shadow-lg hover:shadow-2xl transform hover:scale-105 active:scale-95"
                >
                    <i class="fas fa-download mr-2"></i>
                    Download Predictions CSV
                </button>
            </div>
        </div>

        <!-- Footer -->
        <div class="text-center mt-12 text-white">
            <p class="text-sm opacity-75">¬© 2024 Sentiment Analysis Platform</p>
        </div>
    </div>

    <script>
        let csvBlob = null;

        function handleFileSelect(input) {
            const display = document.getElementById('fileNameDisplay');
            if (input.files.length > 0) {
                display.innerHTML = `<i class="fas fa-check-circle text-green-500 mr-2"></i>${input.files[0].name}`;
            } else {
                display.textContent = 'Choose file or drag here';
            }
        }

        function predict() {
            const csvFileInput = document.getElementById("csvFileInput");
            const textInput = document.getElementById("textInput");
            const predictionResult = document.getElementById("predictionResult");
            const graphContainer = document.getElementById("graphContainer");

            // Show loading state
            predictionResult.innerHTML = `
                <div class="text-center">
                    <div class="inline-block animate-spin rounded-full h-16 w-16 border-b-4 border-purple-600 mb-4"></div>
                    <p class="text-gray-700 font-bold text-xl">Analyzing...</p>
                    <p class="text-gray-500 mt-2">Processing your data</p>
                </div>
            `;
            graphContainer.innerHTML = '';

            if (csvFileInput.files.length > 0) {
                // Handle CSV file upload
                const formData = new FormData();
                formData.append("file", csvFileInput.files[0]);

                fetch("http://localhost:5000/predict", {
                    method: "POST",
                    body: formData
                })
                .then(response => {
                    if (response.headers.get('X-Graph-Exists') === 'true') {
                        const graphData = response.headers.get('X-Graph-Data');
                        displayGraph(graphData);
                    }
                    return response.blob();
                })
                .then(blob => {
                    csvBlob = blob;
                    predictionResult.innerHTML = `
                        <div class="text-center">
                            <div class="w-20 h-20 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i class="fas fa-check text-white text-4xl"></i>
                            </div>
                            <p class="text-gray-800 font-bold text-2xl mb-2">Success!</p>
                            <p class="text-gray-600">CSV file processed successfully</p>
                            <div class="mt-6 p-4 bg-green-50 rounded-xl">
                                <p class="text-green-700 font-semibold">
                                    <i class="fas fa-info-circle mr-2"></i>
                                    Download your results below
                                </p>
                            </div>
                        </div>
                    `;
                    
                    document.getElementById("downloadBtn").style.display = "block";
                })
                .catch(error => {
                    console.error("Error:", error);
                    showError(predictionResult);
                });

            } else if (textInput.value.trim() !== "") {
                // Handle single text prediction
                fetch("http://localhost:5000/predict", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({ "text": textInput.value.trim() })
                })
                .then(response => response.json())
                .then(data => {
                    displaySentiment(data.prediction, predictionResult);
                })
                .catch(error => {
                    console.error("Error:", error);
                    showError(predictionResult);
                });
            } else {
                predictionResult.innerHTML = `
                    <div class="text-center">
                        <i class="fas fa-exclamation-circle text-yellow-500 text-6xl mb-4"></i>
                        <p class="text-gray-800 font-bold text-xl">No Input Provided</p>
                        <p class="text-gray-600 mt-2">Please upload a CSV file or enter text</p>
                    </div>
                `;
            }
        }

        function displaySentiment(sentiment, container) {
            const sentimentLower = sentiment.toLowerCase();
            let icon, colorClass, bgClass, emoji;
            
            if (sentimentLower.includes('positive')) {
                icon = 'fa-smile-beam';
                colorClass = 'text-green-600';
                bgClass = 'result-positive';
                emoji = 'üòä';
            } else if (sentimentLower.includes('negative')) {
                icon = 'fa-frown';
                colorClass = 'text-red-600';
                bgClass = 'result-negative';
                emoji = 'üòû';
            } else {
                icon = 'fa-meh';
                colorClass = 'text-yellow-600';
                bgClass = 'result-neutral';
                emoji = 'üòê';
            }
            
            container.innerHTML = `
                <div class="text-center">
                    <div class="w-32 h-32 ${bgClass} rounded-full flex items-center justify-center mx-auto mb-6 shadow-2xl">
                        <span class="text-7xl">${emoji}</span>
                    </div>
                    <p class="text-gray-600 text-lg mb-2">Sentiment Detected:</p>
                    <p class="text-4xl font-bold ${colorClass} capitalize mb-4">${sentiment}</p>
                    <div class="inline-block px-6 py-3 bg-gray-100 rounded-full">
                        <i class="fas ${icon} ${colorClass} text-2xl"></i>
                    </div>
                </div>
            `;
        }

        function showError(container) {
            container.innerHTML = `
                <div class="text-center">
                    <i class="fas fa-exclamation-triangle text-red-500 text-6xl mb-4"></i>
                    <p class="text-gray-800 font-bold text-xl">Error Occurred</p>
                    <p class="text-gray-600 mt-2">Please check your connection and try again</p>
                </div>
            `;
        }

        function downloadPredictions() {
            if (csvBlob) {
                const url = URL.createObjectURL(csvBlob);
                const a = document.createElement("a");
                a.href = url;
                a.download = "Sentiment_Predictions.csv";
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }
        }

        function displayGraph(graphData) {
            const graphUrl = "data:image/png;base64," + graphData;
            const img = document.createElement('img');
            img.src = graphUrl;
            img.className = 'w-full h-auto rounded-xl shadow-lg';
            img.alt = 'Sentiment Analysis Graph';
            
            const graphContainer = document.getElementById('graphContainer');
            graphContainer.innerHTML = '';
            graphContainer.appendChild(img);
        }

        // Drag and drop functionality
        const fileInput = document.getElementById('csvFileInput');
        const fileLabel = fileInput.nextElementSibling;

        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            fileLabel.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        ['dragenter', 'dragover'].forEach(eventName => {
            fileLabel.addEventListener(eventName, () => {
                fileLabel.classList.add('border-purple-500', 'bg-purple-100');
            }, false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            fileLabel.addEventListener(eventName, () => {
                fileLabel.classList.remove('border-purple-500', 'bg-purple-100');
            }, false);
        });

        fileLabel.addEventListener('drop', (e) => {
            const dt = e.dataTransfer;
            const files = dt.files;
            
            if (files.length > 0 && files[0].name.endsWith('.csv')) {
                fileInput.files = files;
                handleFileSelect(fileInput);
            }
        }, false);
    </script>
</body>
</html>